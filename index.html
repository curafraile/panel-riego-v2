<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Panel de Riego</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; background: #f0f0f0; }
    h1 { color: #2c3e50; }
    .dato { font-size: 2em; margin: 1em 0; padding: 0.5em; border-radius: 10px; display: inline-block; }
    .riego { margin-top: 1em; font-weight: bold; color: #2980b9; }
    button { padding: 1em 2em; font-size: 1em; margin: 0.5em; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #219150; }
    .off { background: #c0392b; }
    .off:hover { background: #a93226; }
  </style>
</head>
<body>
  <h1>🌱 Panel de Riego</h1>
  <div id="humedadBox" class="dato">Humedad actual: <span id="humedad">--</span>%</div>
  <div class="riego">Estado de riego: <span id="estadoRiego">--</span></div>
  <button onclick="activarRiego()">Activar riego</button>
  <button class="off" onclick="desactivarRiego()">Desactivar riego</button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAzXHzQBJHt60kQ14X4a7OZ3fJVdoHGBk8",
      authDomain: "riego-hibrido.firebaseapp.com",
      databaseURL: "https://riego-hibrido-default-rtdb.firebaseio.com",
      projectId: "riego-hibrido",
      storageBucket: "riego-hibrido.appspot.com",
      messagingSenderId: "283637108482",
      appId: "1:283637108482:web:7acc8ccb8b188087cd7c1b"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Lectura de humedad
    db.ref("riego/humedad").on("value", snapshot => {
      const valor = snapshot.val();
      const humedad = document.getElementById("humedad");
      const box = document.getElementById("humedadBox");
      humedad.textContent = valor ?? "--";

      if (valor < 30) {
        box.style.background = "#e74c3c"; // rojo: seco
      } else if (valor < 60) {
        box.style.background = "#f1c40f"; // amarillo: intermedio
      } else {
        box.style.background = "#2ecc71"; // verde: húmedo
      }
    });

    // Lectura del estado de riego
    db.ref("riego/bomba").on("value", snapshot => {
      const estado = snapshot.val();
      document.getElementById("estadoRiego").textContent = estado ?? "--";
    });

    // Activación manual
    function activarRiego() {
      db.ref("riego/bomba").set("ON");
      db.ref("riego/origen").set("manual");
      alert("💧 Riego activado manualmente");
    }

    // Desactivación manual con liberación de control
    function desactivarRiego() {
      db.ref("riego/bomba").set("OFF");
      db.ref("riego/origen").set("auto"); // permite reactivación automática
      alert("🛑 Riego desactivado manualmente");
    }
  </script>
</body>
</html>
